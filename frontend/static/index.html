<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fleet Platform (local)</title>
</head>
<body>
  <h1>Fleet Platform (local) v0.3</h1>

  <section>
    <h2>Crear camión</h2>
    <form id="truckForm">
      <input name="unit_number" placeholder="unit_number (ej. 2827)" required />
      <input name="vin" placeholder="vin (opcional)" />
      <input name="year" placeholder="year (opcional)" />
      <input name="make" placeholder="make (opcional)" />
      <input name="model" placeholder="model (opcional)" />
      <input name="engine" placeholder="engine (opcional)" />
      <button type="submit">Guardar camión</button>
    </form>
    <pre id="truckOut"></pre>
  </section>

  <section>
    <h2>Camiones</h2>
    <button id="truckReload">Recargar</button>
    <pre id="truckList"></pre>
  </section>

  <hr>

  <section>
    <h2>Crear trailer</h2>
    <form id="trailerForm">
      <input name="unit_number" placeholder="unit_number (ej. TR-101)" required />
      <input name="vin" placeholder="vin (opcional)" />

      <select name="type" required>
        <option value="">type...</option>
        <option value="reefer">reefer</option>
        <option value="dry_van">dry_van</option>
        <option value="flatbed">flatbed</option>
      </select>

      <button type="submit">Guardar trailer</button>
    </form>
    <pre id="trailerOut"></pre>
  </section>

  <section>
    <h2>Trailers</h2>
    <button id="trailerReload">Recargar</button>
    <pre id="trailerList"></pre>
  </section>

  <hr>

    <section>
    <h2>Crear conductor</h2>
    <form id="driverForm">
        <input name="name" placeholder="name (ej. Juan Perez)" required />
        <input name="license" placeholder="license (opcional)" />
        <input name="phone" placeholder="phone (opcional)" />

        <select name="pay_type">
        <option value="">pay_type (opcional)...</option>
        <option value="per_km">per_km</option>
        <option value="percent">percent</option>
        <option value="salary">salary</option>
        </select>

        <input name="pay_rate" placeholder="pay_rate (opcional)" />
        <button type="submit">Guardar conductor</button>
    </form>
    <pre id="driverOut"></pre>
    </section>

    <section>
    <h2>Conductores</h2>
    <button id="driverReload">Recargar</button>
    <pre id="driverList"></pre>
    </section>


<script>
async function loadTrucks() {
  const r = await fetch("/api/trucks");
  const data = await r.json();
  document.getElementById("truckList").textContent = JSON.stringify(data, null, 2);
}

async function loadTrailers() {
  const r = await fetch("/api/trailers");
  const data = await r.json();
  document.getElementById("trailerList").textContent = JSON.stringify(data, null, 2);
}

async function loadDrivers() {
  const r = await fetch("/api/drivers");
  const data = await r.json();
  document.getElementById("driverList").textContent = JSON.stringify(data, null, 2);
}

document.getElementById("truckReload").onclick = loadTrucks;
document.getElementById("trailerReload").onclick = loadTrailers;
document.getElementById("driverReload").onclick = loadDrivers;

document.getElementById("truckForm").onsubmit = async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);

  const payload = {
    unit_number: fd.get("unit_number"),
    vin: fd.get("vin") || undefined,
    year: fd.get("year") ? Number(fd.get("year")) : undefined,
    make: fd.get("make") || undefined,
    model: fd.get("model") || undefined,
    engine: fd.get("engine") || undefined
  };

  const r = await fetch("/api/trucks", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(payload)
  });

  const data = await r.json();
  document.getElementById("truckOut").textContent = JSON.stringify(data, null, 2);
  await loadTrucks();
};

document.getElementById("trailerForm").onsubmit = async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);

  const payload = {
    unit_number: fd.get("unit_number"),
    vin: fd.get("vin") || undefined,
    type: fd.get("type")
  };

  const r = await fetch("/api/trailers", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(payload)
  });

  const data = await r.json();
  document.getElementById("trailerOut").textContent = JSON.stringify(data, null, 2);
  await loadTrailers();
};

document.getElementById("driverForm").onsubmit = async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);

  const payType = fd.get("pay_type") || undefined;
  const payRateRaw = fd.get("pay_rate");
  const payload = {
    name: fd.get("name"),
    license: fd.get("license") || undefined,
    phone: fd.get("phone") || undefined,
    pay_type: payType,
    pay_rate: payRateRaw ? Number(payRateRaw) : undefined
  };

  const r = await fetch("/api/drivers", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(payload)
  });

  const data = await r.json();
  document.getElementById("driverOut").textContent = JSON.stringify(data, null, 2);
  await loadDrivers();
};

loadTrucks();
loadTrailers();
loadDrivers();

</script>
</body>
</html>
