<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fleet Platform (local)</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">FP</div>
      <div>
        <div class="brand-title">Fleet Platform</div>
        <div class="brand-subtitle">local v0.7 (corporativo)</div>
      </div>
    </div>

    <div class="topbar-right">
      <div class="pill" id="healthPill">
        <span class="dot"></span>
        <span id="healthText">Conectando…</span>
      </div>
      <a class="btn btn-ghost" href="/dashboard">Dashboard</a>
    </div>
  </header>

  <div class="layout">
    <aside class="sidebar">
      <div class="nav">
        <button class="nav-item is-active" data-view="overview">Resumen</button>
        <button class="nav-item" data-view="fleet">Flota</button>
        <button class="nav-item" data-view="loads">Cargas</button>
        <button class="nav-item" data-view="ops">Operaciones</button>
        <button class="nav-item" data-view="analytics">Analítica</button>
      </div>
      <div class="hint" style="margin-top:12px;">
        Consejo: crea camión, trailer y conductor, luego una carga, y después registra fuel/km/pagos.
      </div>
    </aside>

    <main class="main">
      <div class="container">

        <section class="view is-active" id="view-overview">
          <div class="grid grid-2">
            <div class="card">
              <div class="card-header">
                <div class="card-title">Acciones rápidas</div>
              </div>
              <div class="card-body">
                <div class="card-actions">
                  <button class="btn" data-open-create="trucks">Nuevo camión</button>
                  <button class="btn" data-open-create="trailers">Nuevo trailer</button>
                  <button class="btn" data-open-create="drivers">Nuevo conductor</button>
                  <button class="btn" data-open-create="loads">Nueva carga</button>
                </div>
                <div class="hint" style="margin-top:12px;">
                  Las gráficas están en Dashboard. Aquí verás KPIs y tablas.
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div class="card-title">KPIs</div>
                <div class="card-actions">
                  <button class="btn btn-ghost" id="btnRefreshStats">Recargar</button>
                </div>
              </div>
              <div class="card-body">
                <div class="kpi-grid">
                  <div class="kpi">
                    <div class="kpi-label">Litros totales (fuel)</div>
                    <div class="kpi-value" id="kpiLiters">—</div>
                  </div>
                  <div class="kpi">
                    <div class="kpi-label">Costo total (fuel)</div>
                    <div class="kpi-value" id="kpiFuelCost">—</div>
                  </div>
                  <div class="kpi">
                    <div class="kpi-label">KM totales</div>
                    <div class="kpi-value" id="kpiKm">—</div>
                  </div>
                  <div class="kpi">
                    <div class="kpi-label">Pagos totales</div>
                    <div class="kpi-value" id="kpiPay">—</div>
                  </div>
                </div>
                <div class="small muted" style="margin-top:8px;">Fuente: /api/stats/summary</div>
              </div>
            </div>
          </div>

          <div class="card" style="margin-top:14px;">
            <div class="card-header">
              <div class="card-title">Últimos registros</div>
              <div class="card-actions">
                <button class="btn btn-ghost" id="btnRefreshRecent">Recargar</button>
              </div>
            </div>
            <div class="card-body">
              <div class="grid grid-3">
                <div>
                  <div class="small muted" style="margin-bottom:8px;">Camiones</div>
                  <div class="table-wrap"><table class="table" id="recentTrucks"></table></div>
                </div>
                <div>
                  <div class="small muted" style="margin-bottom:8px;">Cargas</div>
                  <div class="table-wrap"><table class="table" id="recentLoads"></table></div>
                </div>
                <div>
                  <div class="small muted" style="margin-bottom:8px;">Fuel</div>
                  <div class="table-wrap"><table class="table" id="recentFuel"></table></div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="view" id="view-fleet">
          <div class="grid grid-2">
            <div class="card">
              <div class="card-header">
                <div class="card-title">Camiones</div>
                <div class="card-actions">
                  <button class="btn" data-open-create="trucks">Nuevo</button>
                  <button class="btn btn-ghost" data-refresh="trucks">Recargar</button>
                </div>
              </div>
              <div class="card-body">
                <div class="table-wrap"><table class="table" id="tableTrucks"></table></div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div class="card-title">Trailers</div>
                <div class="card-actions">
                  <button class="btn" data-open-create="trailers">Nuevo</button>
                  <button class="btn btn-ghost" data-refresh="trailers">Recargar</button>
                </div>
              </div>
              <div class="card-body">
                <div class="table-wrap"><table class="table" id="tableTrailers"></table></div>
              </div>
            </div>

            <div class="card span-2">
              <div class="card-header">
                <div class="card-title">Conductores</div>
                <div class="card-actions">
                  <button class="btn" data-open-create="drivers">Nuevo</button>
                  <button class="btn btn-ghost" data-refresh="drivers">Recargar</button>
                </div>
              </div>
              <div class="card-body">
                <div class="table-wrap"><table class="table" id="tableDrivers"></table></div>
              </div>
            </div>
          </div>
        </section>

        <section class="view" id="view-loads">
          <div class="card">
            <div class="card-header">
              <div class="card-title">Cargas</div>
              <div class="card-actions">
                <button class="btn" data-open-create="loads">Nueva carga</button>
                <button class="btn btn-ghost" data-refresh="loads">Recargar</button>
              </div>
            </div>
            <div class="card-body">
              <div class="hint">
                Para crear una carga necesitas truck_id, trailer_id y driver_id existentes (ver Flota).
              </div>
              <div class="table-wrap"><table class="table" id="tableLoads"></table></div>
            </div>
          </div>
        </section>

        <section class="view" id="view-ops">
          <div class="grid grid-2">
            <div class="card">
              <div class="card-header">
                <div class="card-title">Fuel entries</div>
                <div class="card-actions">
                  <button class="btn" data-open-create="fuel_entries">Registrar</button>
                  <button class="btn btn-ghost" data-refresh="fuel_entries">Recargar</button>
                </div>
              </div>
              <div class="card-body">
                <div class="table-wrap"><table class="table" id="tableFuel"></table></div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div class="card-title">KM logs</div>
                <div class="card-actions">
                  <button class="btn" data-open-create="km_logs">Registrar</button>
                  <button class="btn btn-ghost" data-refresh="km_logs">Recargar</button>
                </div>
              </div>
              <div class="card-body">
                <div class="table-wrap"><table class="table" id="tableKm"></table></div>
              </div>
            </div>

            <div class="card span-2">
              <div class="card-header">
                <div class="card-title">Pagos a conductores</div>
                <div class="card-actions">
                  <button class="btn" data-open-create="driver_payments">Registrar</button>
                  <button class="btn btn-ghost" data-refresh="driver_payments">Recargar</button>
                </div>
              </div>
              <div class="card-body">
                <div class="table-wrap"><table class="table" id="tablePay"></table></div>
              </div>
            </div>
          </div>
        </section>

        <section class="view" id="view-analytics">
          <div class="grid grid-2">
            <div class="card">
              <div class="card-header">
                <div class="card-title">Resumen (API)</div>
                <div class="card-actions">
                  <button class="btn btn-ghost" id="btnRefreshStats2">Recargar</button>
                </div>
              </div>
              <div class="card-body">
                <pre class="code" id="statsRaw">—</pre>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div class="card-title">Dashboard</div>
              </div>
              <div class="card-body">
                <div class="hint">Dashboard genera gráficas SVG desde el backend.</div>
                <a class="btn" href="/dashboard">Abrir dashboard</a>
              </div>
            </div>
          </div>
        </section>

      </div>
    </main>
  </div>

  <div class="modal" id="modal" aria-hidden="true">
    <div class="modal-backdrop" data-close-modal></div>
    <div class="modal-card" role="dialog" aria-modal="true" aria-label="Crear registro">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">Nuevo</div>
        <button class="icon-btn" data-close-modal aria-label="Cerrar">×</button>
      </div>
      <div class="modal-body">
        <form id="modalForm" class="form"></form>
        <div class="form-actions">
          <button class="btn btn-ghost" data-close-modal type="button">Cancelar</button>
          <button class="btn" id="modalSubmit" type="button">Guardar</button>
        </div>
        <div class="small muted" id="modalHint" style="margin-top:8px;"></div>
      </div>
    </div>
  </div>

  <div class="toasts" id="toasts" aria-live="polite" aria-atomic="true"></div>

  <script src="/app.js"></script>
</body>
</html>
