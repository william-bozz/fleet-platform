<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fleet Platform (local)</title>
</head>
<body>
  <h1>Fleet Platform (local) v0.6</h1>
  <p><a href="/dashboard">Ir al dashboard de gr치ficas</a></p>

  <section>
    <h2>Crear cami칩n</h2>
    <form id="truckForm">
      <input name="unit_number" placeholder="unit_number (ej. 2827)" required />
      <input name="vin" placeholder="vin (opcional)" />
      <input name="year" placeholder="year (opcional)" />
      <input name="make" placeholder="make (opcional)" />
      <input name="model" placeholder="model (opcional)" />
      <input name="engine" placeholder="engine (opcional)" />
      <input name="current_km" placeholder="current_km (opcional)" />
      <button type="submit">Guardar cami칩n</button>
    </form>
    <pre id="truckOut"></pre>
  </section>

  <section>
    <h2>Camiones</h2>
    <button id="truckReload">Recargar</button>
    <pre id="truckList"></pre>
  </section>

  <hr>

  <section>
    <h2>Crear trailer</h2>
    <form id="trailerForm">
      <input name="unit_number" placeholder="unit_number (ej. TR-101)" required />
      <input name="vin" placeholder="vin (opcional)" />
      <select name="type" required>
        <option value="">type...</option>
        <option value="reefer">reefer</option>
        <option value="dry_van">dry_van</option>
        <option value="flatbed">flatbed</option>
      </select>
      <input name="current_km" placeholder="current_km (opcional)" />
      <button type="submit">Guardar trailer</button>
    </form>
    <pre id="trailerOut"></pre>
  </section>

  <section>
    <h2>Trailers</h2>
    <button id="trailerReload">Recargar</button>
    <pre id="trailerList"></pre>
  </section>

  <hr>

  <section>
    <h2>Crear conductor</h2>
    <form id="driverForm">
      <input name="name" placeholder="name (ej. Juan Perez)" required />
      <input name="license" placeholder="license (opcional)" />
      <input name="phone" placeholder="phone (opcional)" />
      <select name="pay_type">
        <option value="">pay_type (opcional)...</option>
        <option value="per_km">per_km</option>
        <option value="percent">percent</option>
        <option value="salary">salary</option>
      </select>
      <input name="pay_rate" placeholder="pay_rate (opcional)" />
      <button type="submit">Guardar conductor</button>
    </form>
    <pre id="driverOut"></pre>
  </section>

  <section>
    <h2>Conductores</h2>
    <button id="driverReload">Recargar</button>
    <pre id="driverList"></pre>
  </section>

  <hr>

  <section>
    <h2>Crear carga</h2>
    <form id="loadForm">
      <input name="reference" placeholder="reference (ej. LOAD-001)" required />
      <input name="shipper" placeholder="shipper (opcional)" />
      <input name="pickup_location" placeholder="pickup_location (opcional)" />
      <input name="delivery_location" placeholder="delivery_location (opcional)" />
      <input name="pickup_date" placeholder="pickup_date (YYYY-MM-DD)" />
      <input name="delivery_date" placeholder="delivery_date (YYYY-MM-DD)" />
      <input name="commodity" placeholder="commodity (opcional)" />
      <input name="weight_kg" placeholder="weight_kg (opcional)" />
      <input name="distance_km" placeholder="distance_km (opcional)" />

      <input name="truck_id" placeholder="truck_id (requerido)" required />
      <input name="trailer_id" placeholder="trailer_id (requerido)" required />
      <input name="driver_id" placeholder="driver_id (requerido)" required />

      <select name="status">
        <option value="">status (default planned)</option>
        <option value="planned">planned</option>
        <option value="in_transit">in_transit</option>
        <option value="delivered">delivered</option>
        <option value="cancelled">cancelled</option>
      </select>

      <button type="submit">Guardar carga</button>
    </form>
    <pre id="loadOut"></pre>
  </section>

  <section>
    <h2>Cargas</h2>
    <button id="loadReload">Recargar</button>
    <pre id="loadList"></pre>
  </section>

  <hr>

  <section>
    <h2>Registrar combustible</h2>
    <form id="fuelForm">
      <input name="truck_id" placeholder="truck_id (requerido)" required />
      <input name="liters" placeholder="liters (requerido)" required />
      <input name="total_cost" placeholder="total_cost (opcional)" />
      <input name="currency" placeholder="currency (USD/MXN) opcional" />
      <input name="odometer_km" placeholder="odometer_km (opcional)" />
      <input name="location" placeholder="location (opcional)" />
      <input name="driver_id" placeholder="driver_id (opcional)" />
      <input name="load_id" placeholder="load_id (opcional)" />
      <input name="fueled_at" placeholder="fueled_at (YYYY-MM-DD HH:MM) opcional" />
      <button type="submit">Guardar fuel</button>
    </form>
    <pre id="fuelOut"></pre>
  </section>

  <section>
    <h2>Fuel entries</h2>
    <button id="fuelReload">Recargar</button>
    <pre id="fuelList"></pre>
  </section>

  <hr>

  <section>
    <h2>Registrar kil칩metros</h2>
    <form id="kmForm">
      <input name="truck_id" placeholder="truck_id (requerido)" required />
      <input name="km" placeholder="km (requerido)" required />
      <input name="odometer_start" placeholder="odometer_start (opcional)" />
      <input name="odometer_end" placeholder="odometer_end (opcional)" />
      <input name="load_id" placeholder="load_id (opcional)" />
      <input name="logged_at" placeholder="logged_at (YYYY-MM-DD HH:MM) opcional" />
      <button type="submit">Guardar km</button>
    </form>
    <pre id="kmOut"></pre>
  </section>

  <section>
    <h2>KM logs</h2>
    <button id="kmReload">Recargar</button>
    <pre id="kmList"></pre>
  </section>

  <hr>

  <section>
    <h2>Registrar pago a conductor</h2>
    <form id="payForm">
      <input name="driver_id" placeholder="driver_id (requerido)" required />
      <input name="amount" placeholder="amount (requerido)" required />
      <input name="currency" placeholder="currency (USD/MXN) opcional" />
      <input name="method" placeholder="method (opcional)" />
      <input name="notes" placeholder="notes (opcional)" />
      <input name="load_id" placeholder="load_id (opcional)" />
      <input name="paid_at" placeholder="paid_at (YYYY-MM-DD HH:MM) opcional" />
      <button type="submit">Guardar pago</button>
    </form>
    <pre id="payOut"></pre>
  </section>

  <section>
    <h2>Driver payments</h2>
    <button id="payReload">Recargar</button>
    <pre id="payList"></pre>
  </section>

  <hr>

  <section>
    <h2>Stats summary</h2>
    <button id="statsReload">Recargar</button>
    <pre id="statsOut"></pre>
  </section>

<script>
async function loadJson(url, elId) {
  const r = await fetch(url);
  const data = await r.json();
  document.getElementById(elId).textContent = JSON.stringify(data, null, 2);
  return data;
}

async function postJson(url, payload, outElId) {
  const r = await fetch(url, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(payload)
  });
  const data = await r.json();
  document.getElementById(outElId).textContent = JSON.stringify(data, null, 2);
  return data;
}

function numOrUndef(v) { return v ? Number(v) : undefined; }
function intOrUndef(v) { return v ? Number(v) : undefined; }
function strOrUndef(v) { return v ? v : undefined; }

async function loadAll() {
  await loadJson("/api/trucks", "truckList");
  await loadJson("/api/trailers", "trailerList");
  await loadJson("/api/drivers", "driverList");
  await loadJson("/api/loads", "loadList");
  await loadJson("/api/fuel_entries", "fuelList");
  await loadJson("/api/km_logs", "kmList");
  await loadJson("/api/driver_payments", "payList");
  await loadJson("/api/stats/summary", "statsOut");
}

document.getElementById("truckReload").onclick = () => loadJson("/api/trucks", "truckList");
document.getElementById("trailerReload").onclick = () => loadJson("/api/trailers", "trailerList");
document.getElementById("driverReload").onclick = () => loadJson("/api/drivers", "driverList");
document.getElementById("loadReload").onclick = () => loadJson("/api/loads", "loadList");
document.getElementById("fuelReload").onclick = () => loadJson("/api/fuel_entries", "fuelList");
document.getElementById("kmReload").onclick = () => loadJson("/api/km_logs", "kmList");
document.getElementById("payReload").onclick = () => loadJson("/api/driver_payments", "payList");
document.getElementById("statsReload").onclick = () => loadJson("/api/stats/summary", "statsOut");

document.getElementById("truckForm").onsubmit = async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const payload = {
    unit_number: fd.get("unit_number"),
    vin: strOrUndef(fd.get("vin")),
    year: numOrUndef(fd.get("year")),
    make: strOrUndef(fd.get("make")),
    model: strOrUndef(fd.get("model")),
    engine: strOrUndef(fd.get("engine")),
    current_km: numOrUndef(fd.get("current_km"))
  };
  await postJson("/api/trucks", payload, "truckOut");
  await loadJson("/api/trucks", "truckList");
  await loadJson("/api/stats/summary", "statsOut");
};

document.getElementById("trailerForm").onsubmit = async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const payload = {
    unit_number: fd.get("unit_number"),
    vin: strOrUndef(fd.get("vin")),
    type: fd.get("type"),
    current_km: numOrUndef(fd.get("current_km"))
  };
  await postJson("/api/trailers", payload, "trailerOut");
  await loadJson("/api/trailers", "trailerList");
};

document.getElementById("driverForm").onsubmit = async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const payload = {
    name: fd.get("name"),
    license: strOrUndef(fd.get("license")),
    phone: strOrUndef(fd.get("phone")),
    pay_type: strOrUndef(fd.get("pay_type")),
    pay_rate: numOrUndef(fd.get("pay_rate"))
  };
  await postJson("/api/drivers", payload, "driverOut");
  await loadJson("/api/drivers", "driverList");
  await loadJson("/api/stats/summary", "statsOut");
};

document.getElementById("loadForm").onsubmit = async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const payload = {
    reference: fd.get("reference"),
    shipper: strOrUndef(fd.get("shipper")),
    pickup_location: strOrUndef(fd.get("pickup_location")),
    delivery_location: strOrUndef(fd.get("delivery_location")),
    pickup_date: strOrUndef(fd.get("pickup_date")),
    delivery_date: strOrUndef(fd.get("delivery_date")),
    commodity: strOrUndef(fd.get("commodity")),
    weight_kg: numOrUndef(fd.get("weight_kg")),
    distance_km: numOrUndef(fd.get("distance_km")),
    truck_id: Number(fd.get("truck_id")),
    trailer_id: Number(fd.get("trailer_id")),
    driver_id: Number(fd.get("driver_id")),
    status: strOrUndef(fd.get("status"))
  };
  await postJson("/api/loads", payload, "loadOut");
  await loadJson("/api/loads", "loadList");
};

document.getElementById("fuelForm").onsubmit = async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const payload = {
    truck_id: Number(fd.get("truck_id")),
    liters: Number(fd.get("liters")),
    total_cost: numOrUndef(fd.get("total_cost")),
    currency: strOrUndef(fd.get("currency")),
    odometer_km: numOrUndef(fd.get("odometer_km")),
    location: strOrUndef(fd.get("location")),
    driver_id: intOrUndef(fd.get("driver_id")),
    load_id: intOrUndef(fd.get("load_id")),
    fueled_at: strOrUndef(fd.get("fueled_at"))
  };
  await postJson("/api/fuel_entries", payload, "fuelOut");
  await loadJson("/api/fuel_entries", "fuelList");
  await loadJson("/api/stats/summary", "statsOut");
};

document.getElementById("kmForm").onsubmit = async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const payload = {
    truck_id: Number(fd.get("truck_id")),
    km: Number(fd.get("km")),
    odometer_start: numOrUndef(fd.get("odometer_start")),
    odometer_end: numOrUndef(fd.get("odometer_end")),
    load_id: intOrUndef(fd.get("load_id")),
    logged_at: strOrUndef(fd.get("logged_at"))
  };
  await postJson("/api/km_logs", payload, "kmOut");
  await loadJson("/api/km_logs", "kmList");
  await loadJson("/api/stats/summary", "statsOut");
};

document.getElementById("payForm").onsubmit = async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const payload = {
    driver_id: Number(fd.get("driver_id")),
    amount: Number(fd.get("amount")),
    currency: strOrUndef(fd.get("currency")),
    method: strOrUndef(fd.get("method")),
    notes: strOrUndef(fd.get("notes")),
    load_id: intOrUndef(fd.get("load_id")),
    paid_at: strOrUndef(fd.get("paid_at"))
  };
  await postJson("/api/driver_payments", payload, "payOut");
  await loadJson("/api/driver_payments", "payList");
  await loadJson("/api/stats/summary", "statsOut");
};

loadAll();
</script>
</body>
</html>
